/*
Archivo para exportar de PROSCAI a SHOPIFY
Esta versión del 08/05/20 ya incluye el campo ICOMPOS el cual hace referencia a la sección
de composición de otros dentro de proscai
Los modelos se ordenan de mayo a menor
El query da un handle por default, si es para actualizar campos es necesario copiar el de 
shopify y reemplazarlo
Esta versión busca la tienda y si tiene existencias y lo manda, no es recomendable para modelos en 0
ya que no dará información
*/
SELECT
'' as Largo,
FAM3.FAMDESCR AS 'Palabra clave',
If(FAM4.FAMDESCR = 'BASICO','BASICA',FAM4.FAMDESCR) AS 'Palabra clave',
FAM5.FAMDESCR AS 'Palabra clave',
FAM8.FAMDESCR AS 'Palabra clave',
FAM9.FAMDESCR AS 'Palabra clave',
ICODSAT AS 'Categoría SAT',
IDESCR AS 'Título de publicación en Mercado Libre',
CONCAT(FAM3.FAMDESCR,' TOXIC ','DE ',FAM5.FAMDESCR,' MODELO: ', MID(ICOD,1,9),' COLOR: ',CATDESCR) AS 'Párrafo 1',
ICOMPOS as 'Párrafo 2',
'' as 'Párrafo 3',
'' as 'Párrafo 4',
CONCAT(FAM3.FAMDESCR,' ', if(FAM4.FAMDESCR = 'BASICO','BASICA',FAM4.FAMDESCR)) AS  'Bullet 1',
FAM5.FAMDESCR AS 'Bullet 2',
ICOMPOS as 'Bullet 3',
IF(FAM8.FAMDESCR='ROCK TEES','MERCANCÍA DE CALIDAD','MERCANCÍA OFICIAL')  as 'Bullet 4',
FAM2.FAMDESCR as 'Bullet 5',
CATDESCR AS 'Color',
/*IF(MID(ICOD,12,13)= 'CH','S', IF(MID(ICOD,12,13)='MD','M',IF(MID(ICOD,12,13)='GD','L',IF(MID(ICOD,12,13)='EG','XL',IF(MID(ICOD,12,13)='UN','UNITALLA',MID(ICOD,12,13)))))) AS 'Talla',*/
MID(ICOD,12,13) as Talla,
ICOD AS SKU,
'TOXIC' AS Marca,
MID(ICOD,1,9) AS Model,
IF(FAM3.FAMDESCR = 'PLAYERA',IF(MID(ICOD,12,13)='CH','66',IF(MID(ICOD,12,13)='MD','67',  IF(MID(ICOD,12,13)='GD','71',IF(MID(ICOD,12,13)='EG','74', MID(ICOD,12,13))))),
IF(MID(ICOD,12,13)='CH','62', IF(MID(ICOD,12,13)='MD','64',  IF(MID(ICOD,12,13)='GD','65',IF(MID(ICOD,12,13)='EG','66',MID(ICOD,12,13)))))) as Largo,

'' as 'Alto',


IF(FAM3.FAMDESCR = 'PLAYERA',IF(MID(ICOD,12,13)='CH','51',IF(MID(ICOD,12,13)='MD','53',  IF(MID(ICOD,12,13)='GD','56',IF(MID(ICOD,12,13)='EG','58', MID(ICOD,12,13))))),
IF(MID(ICOD,12,13)='CH','43', IF(MID(ICOD,12,13)='MD','45',  IF(MID(ICOD,12,13)='GD','48',IF(MID(ICOD,12,13)='EG','51',MID(ICOD,12,13)))))) as Ancho,

IEAN as 'Código de Barras',

'.175' AS 'Peso En Kg',

'' 'YouTube',

ROUND(ALMCANT,0) as 'Stock',
1 as 'Pedido Múltiple',
'' as 'Precio para Ibushak',
'MXN' as Moneda,
ilista1 as '"Precio Venta (Cliente Final)CON IVA"',
'' as 'Precio Público Oferta Con IVA',
'' as 'NO TOCAR',
'' AS '3000%',
'' AS 'Fecha inicio oferta',
''AS 'Fecha fin oferta',
'Unicamente por defecto de fábrica' AS 'Garantía',
'' AS 'Imagen Principal',
'' AS 'Imagen 2',
'' AS 'Imagen 3',
'' AS 'Imagen 4',
'' AS 'Imagen 5',
'' AS 'Imagen 6',
'' AS 'Imagen 7',
'' AS 'Imagen 8',
MID(ICOD,1,11) as 'Modelo para imagen'











/*
Las siguientes líneas son  de información y búsqueda
*/


from FINV


LEFT JOIN FALM ON FALM.ISEQ = FINV.ISEQ
LEFT JOIN FFAM AS FAM1 ON FAM1.FAMTNUM=FINV.IFAM1
LEFT JOIN FFAM AS FAM2 ON FAM2.FAMTNUM=FINV.IFAM2
LEFT JOIN FFAM AS FAM3 ON FAM3.FAMTNUM=FINV.IFAM3
LEFT JOIN FFAM AS FAM4 ON FAM4.FAMTNUM=FINV.IFAM4
LEFT JOIN FFAM AS FAM5 ON FAM5.FAMTNUM=FINV.IFAM5
LEFT JOIN FFAM AS FAM6 ON FAM6.FAMTNUM=FINV.IFAM6
LEFT JOIN FFAM AS FAM7 ON FAM7.FAMTNUM=FINV.IFAM7
LEFT JOIN FFAM AS FAM8 ON FAM8.FAMTNUM=FINV.IFAM8
LEFT JOIN FFAM AS FAM9 ON FAM9.FAMTNUM=FINV.IFAM9
LEFT JOIN FFAM AS FAMA ON FAMA.FAMTNUM=FINV.IFAMA
LEFT JOIN FALMCAT ON FALMCAT.CATCOD = FINV.ICOLOR

WHERE ITIPO = 1 AND (CATTIPO ='POL' OR CATTIPO ='TAL') AND 
/*
Aqui van todos los modelos que capturemos
*/
(MID(ICOD,1,11)='PLCNH9102NE' OR
MID(ICOD,1,11)='PLCPP0102CA' OR 
MID(ICOD,1,11)='PLCPP9402NE' OR 
MID(ICOD,1,11)='PLCPP9405NE' OR 
MID(ICOD,1,11)='PLCR29B01NE' OR 
MID(ICOD,1,11)='PLCRF9401SN' OR 
MID(ICOD,1,11)='PLCRL9106NE' OR 
MID(ICOD,1,11)='PLCRL9202NE' OR 
MID(ICOD,1,11)='PLCRL9B05NE' OR 
MID(ICOD,1,11)='PLCRL9B06BC' OR 
MID(ICOD,1,11)='PLCRL9B07NE' OR 
MID(ICOD,1,11)='PLCRR9B01NS' OR 
MID(ICOD,1,11)='PLCRR9C01NE' OR 
MID(ICOD,1,11)='PLCRV9401NE' OR 
MID(ICOD,1,11)='PLCTS0102PL' OR 
MID(ICOD,1,11)='PLCTS9405NE' OR 
MID(ICOD,1,11)='PLCTS9B01NE' OR 
MID(ICOD,1,11)='PLCTT9403NE' OR 
MID(ICOD,1,11)='PLCTT9B01NE' OR 
MID(ICOD,1,11)='PLCWL9401VV' OR 
MID(ICOD,1,11)='PLCWP9401BR' OR 
MID(ICOD,1,11)='PLCWW9101NE' OR 
MID(ICOD,1,11)='PLNBB9401PN' OR 
MID(ICOD,1,11)='PLNRM9401NE' OR 
MID(ICOD,1,11)='PLNRR9401NE' OR 
MID(ICOD,1,11)='BLDBB9B04UU' OR 
MID(ICOD,1,11)='BLDBB9B07NE' OR 
MID(ICOD,1,11)='BLDBG0C03NE' OR 
MID(ICOD,1,11)='BLDBQ9B02NE' OR 
MID(ICOD,1,11)='BLDCB9101JJ' OR 
MID(ICOD,1,11)='BLDEK9401NE' OR 
MID(ICOD,1,11)='BLDHH9403VV' OR 
MID(ICOD,1,11)='BLDHH9P03BC' OR 
MID(ICOD,1,11)='BLDJF9101RJ' OR 
MID(ICOD,1,11)='BLDLM9301NE' OR 
MID(ICOD,1,11)='BLDMC9401MA' OR 
MID(ICOD,1,11)='BLDMV9P01BC' OR 
MID(ICOD,1,11)='BLDNB9401BN' OR 
MID(ICOD,1,11)='BLDNC9401BN' OR 
MID(ICOD,1,11)='BLDND9401NE' OR 
MID(ICOD,1,11)='BLDND9402NE' OR 
MID(ICOD,1,11)='BLDNJ9301BR' OR 
MID(ICOD,1,11)='BLDPP9301VV' OR 
MID(ICOD,1,11)='BLDR29C02NE' OR 
MID(ICOD,1,11)='BLDRI9C04NE' OR 
MID(ICOD,1,11)='BLDRJ9102NE' OR 
MID(ICOD,1,11)='BLDRM9402NE' OR 
MID(ICOD,1,11)='BLDRM9403NE' OR 
MID(ICOD,1,11)='BLDRT9302NE' OR 
MID(ICOD,1,11)='BLDTC0101NE' OR 
MID(ICOD,1,11)='BLDTS9303NE' OR 
MID(ICOD,1,11)='BLDTS9402BN' OR 
MID(ICOD,1,11)='BLDWH0P01NE' OR 
MID(ICOD,1,11)='BLDWI9P01BC' OR 
MID(ICOD,1,11)='BLDWJ9P01NE' OR 
MID(ICOD,1,11)='PLCBB9404NE' OR 
MID(ICOD,1,11)='PLCBB9405PL' OR 
MID(ICOD,1,11)='PLCBB9B03NE' OR 
MID(ICOD,1,11)='PLCBQ9401KK' OR 
MID(ICOD,1,11)='PLCBQ9B03NE' OR 
MID(ICOD,1,11)='PLCBQ9B03SN' OR 
MID(ICOD,1,11)='PLCBR9406BR' OR 
MID(ICOD,1,11)='PLCDF9P01AA' OR 
MID(ICOD,1,11)='PLCJA9P03NE' OR 
MID(ICOD,1,11)='PLCJA9P04NE' OR 
MID(ICOD,1,11)='PLCMC9401MA' OR 
MID(ICOD,1,11)='PLCMC9403MA' OR 
MID(ICOD,1,11)='PLCMC9B12UU' OR 
MID(ICOD,1,11)='PLCMC9B13UU' OR 
MID(ICOD,1,11)='PLCMC9P15NE' OR 
MID(ICOD,1,11)='PLCMC9P16MA' OR 
MID(ICOD,1,11)='PLCMC9P18MA' OR 
MID(ICOD,1,11)='PLCMP9401NE' OR 
MID(ICOD,1,11)='PLCMP9402NE' OR 
MID(ICOD,1,11)='PLCMP9B06NE' OR 
MID(ICOD,1,11)='PLCMS0101PL' OR 
MID(ICOD,1,11)='PLCNB9401NE' OR 
MID(ICOD,1,11)='PLCNB9405NE' OR 
MID(ICOD,1,11)='PLCND9401NE' OR 
MID(ICOD,1,11)='PLCNH9103NE' OR 
MID(ICOD,1,11)='PLCNH9207NE' OR 
MID(ICOD,1,11)='PLCNM9401NE' OR 
MID(ICOD,1,11)='PLCPA9301EN' OR 
MID(ICOD,1,11)='PLCPP9401NE' OR 
MID(ICOD,1,11)='PLCPP9403NE' OR 
MID(ICOD,1,11)='PLCR29C11NE' OR 
MID(ICOD,1,11)='PLCRI9C01PL' OR 
MID(ICOD,1,11)='PLCRJ9103BC' OR 
MID(ICOD,1,11)='PLCRL0102NE' OR 
MID(ICOD,1,11)='PLCRM9402NE' OR 
MID(ICOD,1,11)='PLCRO9C01RY' OR
MID(ICOD,1,11)='PLCRT9401NE' OR 
MID(ICOD,1,11)='PLCTS9403NE' OR 
MID(ICOD,1,11)='PLCW19401NE' OR 
MID(ICOD,1,11)='PLCWG9401NS' OR 
MID(ICOD,1,11)='PLCWT9401NE' OR 
MID(ICOD,1,11)='PLNLB9P01NE' OR 
MID(ICOD,1,11)='PLNMC9P01RY')


/*
Aqui va el número de almacén
*/
AND ALMNUM = 909
GROUP BY IEAN
ORDER BY  CONCAT(MID(ICOD,1,9),IF(MID(ICOD,12,13)= 'CH','1', IF(MID(ICOD,12,13)='MD','2',IF(MID(ICOD,12,13)='GD','3',IF(MID(ICOD,12,13)='EG','4',IF(MID(ICOD,12,13)='XX','5', MID(ICOD,12,13)))))))

