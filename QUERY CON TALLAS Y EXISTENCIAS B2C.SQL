/*
Archivo para exportar de PROSCAI a SHOPIFY
Esta versión del 08/05/20 ya incluye el campo ICOMPOS el cual hace referencia a la sección
de composición de otros dentro de proscai
Los modelos se ordenan de mayo a menor
El query da un handle por default, si es para actualizar campos es necesario copiar el de 
shopify y reemplazarlo
Esta versión busca la tienda y si tiene existencias y lo manda, no es recomendable para modelos en 0
ya que no dará información
*/
SELECT
CONCAT(FAM3.FAMDESCR,'-',FAM5.FAMDESCR,'-',MID(ICOD,1,9),'-',IF (CATDESCR='NEGRO SNOW','GRIS',IF(CATDESCR='CARBON','GRIS',IF(CATDESCR='JASPE','GRIS',IF(CATDESCR='OXFORD','GRIS',IF(CATDESCR='REY','AZUL',IF(CATDESCR='MARINO','AZUL',IF(CATDESCR='JADE','VERDE',IF(CATDESCR='MENTA','MULTICOLOR',IF(CATDESCR='VARIOS','MULTI COLOR',CATDESCR)))))))))) as Handle,
IDESCR AS Title,
CONCAT('<p>',IDESCR,' ','<br><br>',ICOMPOS,'<p>HECHO EN MÉXICO</p>') as 'Body (HTML)',
IF(FAM2.FAMDESCR ='CABALLERO','CHAVOS',IF(FAM2.FAMDESCR ='DAMA','CHAVAS',FAM2.FAMDESCR)) AS Vendor,
FAM3.FAMDESCR AS 'Type',
CONCAT(MID(ICOD,1,9),',','_cf-talla-s,_cf-talla-m, _cf-talla-l, _cf-talla-xl,_sku_config_',',',MID(ICOD,1,9),
',',FAM8.FAMDESCR,',',IF(FAM5.FAMDESCR='HEROES DC','JUSTICE LEAGUE',FAM5.FAMDESCR),',',FAM9.FAMDESCR,',',
IF(FAM9.FAMDESCR='COMICS','ENTRETENIMIENTO',IF(FAM9.FAMDESCR='ANIME','ENTRETENIMIENTO', IF(FAM9.FAMDESCR='CARICATURAS','ENTRETENIMIENTO',IF(FAM9.FAMDESCR='PELICULAS','ENTRETENIMIENTO',IF(FAM9.FAMDESCR='VIDEO JUEGOS','ENTRETENIMIENTO',IF(FAM9.FAMDESCR='SEIERES','ENTRETENIMIENTO',IF(FAM9.FAMDESCR='SEIERES','DEPORTES','ROCKERO'))))))),',',
FAM3.FAMDESCR,',',FAM4.FAMDESCR,',',
IF (CATDESCR='NEGRO SNOW','GRIS',IF(CATDESCR='CARBON','GRIS',IF(CATDESCR='JASPE','GRIS',IF(CATDESCR='OXFORD','GRIS',IF(CATDESCR='REY','AZUL',IF(CATDESCR='MARINO','AZUL',IF(CATDESCR='JADE','VERDE',IF(CATDESCR='MENTA','MULTICOLOR',IF(CATDESCR='VARIOS','MULTI COLOR',CATDESCR)))))))))) as Tags,
'true' as Published,
'Color' as 'Option1 Name',
IF (CATDESCR='NEGRO SNOW','GRIS',IF(CATDESCR='CARBON','GRIS',IF(CATDESCR='JASPE','GRIS',IF(CATDESCR='OXFORD','GRIS',IF(CATDESCR='REY','AZUL',IF(CATDESCR='MARINO','AZUL',IF(CATDESCR='JADE','VERDE',IF(CATDESCR='MENTA','MULTICOLOR',IF(CATDESCR='VARIOS','MULTI COLOR',CATDESCR))))))))) AS 'Option1 Value',
'Talla' as 'Option2 Name',
IF(MID(ICOD,12,13)= 'CH','S', IF(MID(ICOD,12,13)='MD','M',IF(MID(ICOD,12,13)='GD','L',IF(MID(ICOD,12,13)='EG','XL',IF(MID(ICOD,12,13)='UN','UNITALLA',MID(ICOD,12,13)))))) AS 'Option2 Value',
NULL AS 'Option3 Name',
NULL AS 'Option3 Value',
ICOD AS 'Variant SKU',
'1000' AS 'Variant Grams',
'shopify' as 'Variant Inventory Tracker',
ROUND(ALMCANT,0) as 'Variant Inventory Qty',
'deny' as 'Variant Inventory Policy',
'manual' as 'Variant Fulfillment Service',
ilista1 as 'Variant Price',
null as 'Variant Compare At Price',
'true' as 'Variant Requires Shipping',
'false' as Taxable,
concat("'",iean) as 'Variant Barcode',
null as 'Image Src',
null as 'Image Position',
null as 'Image Alt Text',
null as 'Gift Card',
null as 'SEO Title',
null as 'SEO Description',
null as 'Google Shopping / Google Product Category',
null as 'Google Shopping / Gender',
null as 'Google Shopping / Age Group',
null as 'Google Shopping / MPN',
null as 'Google Shopping / AdWords Grouping',
null as 'Google Shopping / AdWords Labels',
null as 'Google Shopping / Condition',
null as 'Google Shopping / Custom Product',
null as 'Google Shopping / Custom Label 0',
null as 'Google Shopping / Custom Label 1',
null as 'Google Shopping / Custom Label 2',
null as 'Google Shopping / Custom Label 3',
null as 'Google Shopping / Custom Label 4',
null as 'Variant Image',
'kg' as 'Variant Weight Unit',
null as 'Variant Tax Code',
null as 'Cost per item',
/*
Las siguientes líneas son  de información y búsqueda
*/
MID(ICOD,1,11)AS MODELO_COLOR,
ICOD AS MODELO,
IDESCR AS DESCRIPCION

from FINV


LEFT JOIN FALM ON FALM.ISEQ = FINV.ISEQ
LEFT JOIN FFAM AS FAM1 ON FAM1.FAMTNUM=FINV.IFAM1
LEFT JOIN FFAM AS FAM2 ON FAM2.FAMTNUM=FINV.IFAM2
LEFT JOIN FFAM AS FAM3 ON FAM3.FAMTNUM=FINV.IFAM3
LEFT JOIN FFAM AS FAM4 ON FAM4.FAMTNUM=FINV.IFAM4
LEFT JOIN FFAM AS FAM5 ON FAM5.FAMTNUM=FINV.IFAM5
LEFT JOIN FFAM AS FAM6 ON FAM6.FAMTNUM=FINV.IFAM6
LEFT JOIN FFAM AS FAM7 ON FAM7.FAMTNUM=FINV.IFAM7
LEFT JOIN FFAM AS FAM8 ON FAM8.FAMTNUM=FINV.IFAM8
LEFT JOIN FFAM AS FAM9 ON FAM9.FAMTNUM=FINV.IFAM9
LEFT JOIN FFAM AS FAMA ON FAMA.FAMTNUM=FINV.IFAMA
LEFT JOIN FALMCAT ON FALMCAT.CATCOD = FINV.ICOLOR

WHERE ITIPO = 1 AND (CATTIPO ='POL' OR CATTIPO ='TAL') AND 
/*
Aqui van todos los modelos que capturemos
*/

(MID(ICOD,1,11)='ACUTT0204NE' OR MID(ICOD,1,11)='ACUTT0203NE' OR MID(ICOD,1,11)='ACUTT0202NE' OR MID(ICOD,1,11)='ACUTT0201NE' OR MID(ICOD,1,11)='PLCPP9301UU' OR MID(ICOD,1,11)='PLCRV9B04NE' OR MID(ICOD,1,11)='PLCRL9106NE' OR MID(ICOD,1,11)='PLCRL9B07NE' OR MID(ICOD,1,11)='PLCBG9B08PL' OR MID(ICOD,1,11)='PLCBG9302NE' OR MID(ICOD,1,11)='BLDHH9301CA' OR MID(ICOD,1,11)='SUCLN9401JJ' OR MID(ICOD,1,11)='ACUTT0101NE' OR MID(ICOD,1,11)='VEDAN9101NE' OR MID(ICOD,1,11)='VEDGM9101NE' OR MID(ICOD,1,11)='VEDAM9101NE' OR MID(ICOD,1,11)='VEDMS9108KK' OR MID(ICOD,1,11)='VEDMS9109NE' OR MID(ICOD,1,11)='VEDVO9405NE' OR MID(ICOD,1,11)='VEDVO9405CC' OR MID(ICOD,1,11)='VEDAA9P01NE' OR MID(ICOD,1,11)='VEDGG9101NE' OR MID(ICOD,1,11)='VEDTB9401NE' OR MID(ICOD,1,11)='SUNMS9B01RJ' OR MID(ICOD,1,11)='SUNCB9B01NE' OR MID(ICOD,1,11)='SUCBJ9102NS' OR MID(ICOD,1,11)='SUCHH9P03NE' OR MID(ICOD,1,11)='SUCDF9B01RJ' OR MID(ICOD,1,11)='SUDPP9B02NE' OR MID(ICOD,1,11)='SUCMC9B07AZ' OR MID(ICOD,1,11)='SUCCB9101NE' OR MID(ICOD,1,11)='SUCJA9P02NE' OR MID(ICOD,1,11)='CNUTS9P01NE' OR MID(ICOD,1,11)='PLNBB9401PN' OR MID(ICOD,1,11)='PLNRM9401NE' OR MID(ICOD,1,11)='PLCBG0C02BC' OR MID(ICOD,1,11)='CHDGC9B01NE' OR MID(ICOD,1,11)='CHDAH9P01RJ' OR MID(ICOD,1,11)='CHCRM0C01NE' OR MID(ICOD,1,11)='BLDMS9B09NE' OR MID(ICOD,1,11)='BLDBQ9B02GO' OR MID(ICOD,1,11)='PLCJF9114RJ' OR MID(ICOD,1,11)='PLCMS9B02RJ' OR MID(ICOD,1,11)='PLCBS9B02NE' OR MID(ICOD,1,11)='PLNRR9401NE' OR MID(ICOD,1,11)='PLCBQ9101NE' OR MID(ICOD,1,11)='PLCRL9102NE' OR MID(ICOD,1,11)='PLCRL9B09NE' OR MID(ICOD,1,11)='PLCMD9P04NE' OR MID(ICOD,1,11)='PLCBB9402NE' OR MID(ICOD,1,11)='PLCEA0101NE' OR MID(ICOD,1,11)='PLCR29B03NE' OR MID(ICOD,1,11)='BLDRP9C02NE' OR MID(ICOD,1,11)='BLDPP9C03NE' OR MID(ICOD,1,11)='BLDBG9B05CA' OR MID(ICOD,1,11)='ACUOS0102NE' OR MID(ICOD,1,11)='ACUOS0102MM' OR MID(ICOD,1,11)='ACUOR0101NE' OR MID(ICOD,1,11)='ACUOR0101BC' OR MID(ICOD,1,11)='ACUOG9405NE' OR MID(ICOD,1,11)='ACUOG9405BC' OR MID(ICOD,1,11)='ACUOB0101TT' OR MID(ICOD,1,11)='ACDAC0101RJ' OR MID(ICOD,1,11)='SUCCB9B01NE' OR MID(ICOD,1,11)='SUCAT9B01NE' OR MID(ICOD,1,11)='PLCTS9405NE' OR MID(ICOD,1,11)='PLCAH9B01NE' OR MID(ICOD,1,11)='SRDAC9B01NE' OR MID(ICOD,1,11)='SRDAC9401NE' OR MID(ICOD,1,11)='SHDRH0P01MZ' OR MID(ICOD,1,11)='SUCWI9P07TT' OR MID(ICOD,1,11)='SUCHH0101NR' OR MID(ICOD,1,11)='SUDGR9B01GN' OR MID(ICOD,1,11)='SUDGR9B02GN' OR MID(ICOD,1,11)='SUDBB9B01NJ' OR MID(ICOD,1,11)='SUCBB9B05NG' OR MID(ICOD,1,11)='SUCJB9B01NE' OR MID(ICOD,1,11)='SUDCU9B01TT' OR MID(ICOD,1,11)='SUATU9B01NE' OR MID(ICOD,1,11)='SUDCT9B01GR' OR MID(ICOD,1,11)='SUCSS9401NE' OR MID(ICOD,1,11)='SUCSS9402SN' OR MID(ICOD,1,11)='SUDPP9B01JJ' OR MID(ICOD,1,11)='SUCSS9404JJ' OR MID(ICOD,1,11)='SUCCJ9101NE' OR MID(ICOD,1,11)='SUCHH9401NR' OR MID(ICOD,1,11)='SUCMS9B01RJ' OR MID(ICOD,1,11)='SUDNV9401JJ' OR MID(ICOD,1,11)='SUDBR9402JJ' OR MID(ICOD,1,11)='SUCBR9403JJ' OR MID(ICOD,1,11)='SUDWT9P01NE' OR MID(ICOD,1,11)='SUCWT9401NE' OR MID(ICOD,1,11)='SUCPP9C01NS' OR MID(ICOD,1,11)='SUCPP9C01NE' OR MID(ICOD,1,11)='SUDPP9B02NS' OR MID(ICOD,1,11)='SUCRM9B01NS' OR MID(ICOD,1,11)='SUDRI9C01NE' OR MID(ICOD,1,11)='SUCRI9C01NE' OR MID(ICOD,1,11)='SUDWG9P01JJ' OR MID(ICOD,1,11)='SUDMC9B04NE')

/*
Aqui va el número de almacén
*/
AND ALMNUM = 902
GROUP BY IEAN
ORDER BY  CONCAT(MID(ICOD,1,9),IF(MID(ICOD,12,13)= 'CH','1', IF(MID(ICOD,12,13)='MD','2',IF(MID(ICOD,12,13)='GD','3',IF(MID(ICOD,12,13)='EG','4',IF(MID(ICOD,12,13)='XX','5', MID(ICOD,12,13)))))))



